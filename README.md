# 简单RISC-V处理器

这是一个基于 RISC-V 指令集架构的简单五级流水线处理器实现。

目前进度是将要进行完整指令测试。

---

## 特点

- 支持 RV32I 基本整数指令集
- 五级流水线架构（IF/ID/EX/MEM/WB）
- 实现数据相关和控制相关处理
- 支持字节/半字/字访问
- 使用 Verilog HDL 实现
- 包含完整的测试框架

## 目录结构

```
.
├── rtl/                    # RTL设计文件
│   ├── core/              # 处理器核心模块
│   │   ├── fetch.v       # 取指级
│   │   ├── decode.v      # 译码级
│   │   ├── execute.v     # 执行级
│   │   ├── regfile.v     # 寄存器堆
│   │   └── pipeline_ctrl.v # 流水线控制
│   ├── memory/           # 存储器模块
│   │   ├── inst_mem.v    # 指令存储器
│   │   └── data_mem.v    # 数据存储器
│   └── top.v             # 顶层模块
├── sim/                   # 仿真文件
│   ├── tb/               # 测试文件
│   │   ├── top_tb.v     # 顶层测试
│   │   └── ...          # 其他模块测试
│   └── hex/              # 测试程序
│       └── inst.hex      # 指令存储器初始化文件
└── scripts/              # 编译和仿真脚本
    ├── compile.sh        # 编译脚本
    └── simulate.sh       # 仿真脚本
```

## 开发环境

- Icarus Verilog (iverilog)
- GTKWave
- GNU Make

## 编译和仿真

1. 编译所有模块：
```bash
make
```

2. 运行所有测试：
```bash
make test
```

3. 查看波形：
```bash
make wave
```

## 支持的指令

目前正在实现和测试中：

### 算术指令
- [x] ADDI - 立即数加法
- [x] ADD  - 寄存器加法
- [x] SUB  - 寄存器减法
- [ ] AUIPC - 高位立即数加PC
- [ ] LUI  - 加载高位立即数

### 逻辑指令
- [ ] AND  - 按位与
- [ ] OR   - 按位或
- [ ] XOR  - 按位异或
- [ ] ANDI - 立即数按位与
- [ ] ORI  - 立即数按位或
- [ ] XORI - 立即数按位异或

### 移位指令
- [ ] SLL  - 逻辑左移
- [ ] SRL  - 逻辑右移
- [ ] SRA  - 算术右移
- [ ] SLLI - 立即数逻辑左移
- [ ] SRLI - 立即数逻辑右移
- [ ] SRAI - 立即数算术右移

### 比较指令
- [ ] SLT  - 有符号小于比较
- [ ] SLTU - 无符号小于比较
- [ ] SLTI - 立即数有符号小于比较
- [ ] SLTIU - 立即数无符号小于比较

### 分支指令
- [ ] BEQ  - 相等跳转
- [ ] BNE  - 不等跳转
- [ ] BLT  - 小于跳转
- [ ] BGE  - 大于等于跳转
- [ ] BLTU - 无符号小于跳转
- [ ] BGEU - 无符号大于等于跳转

### 跳转指令
- [ ] JAL  - 跳转并链接
- [ ] JALR - 寄存器跳转并链接

### 访存指令
- [x] LW   - 加载字
- [x] SW   - 存储字
- [ ] LH   - 加载半字
- [ ] LHU  - 加载半字无符号
- [ ] LB   - 加载字节
- [ ] LBU  - 加载字节无符号
- [ ] SH   - 存储半字
- [ ] SB   - 存储字节

### 其他指令
- [ ] FENCE - 内存序同步
- [ ] ECALL - 环境调用
- [ ] EBREAK - 断点

## 流水线架构

1. IF (取指)：从指令存储器获取指令
2. ID (译码)：解码指令并读取寄存器
3. EX (执行)：执行ALU运算或地址计算
4. MEM (访存)：访问数据存储器
5. WB (写回)：将结果写回寄存器堆

## 数据相关处理

- 实现寄存器转发
- 实现流水线暂停
- 处理加载-使用相关

## 控制相关处理

- 分支预测：始终预测不跳转
- 分支判断在EX阶段完成
- 错误预测时刷新流水线

## 许可证

[MIT License](./LICENSE)

## 贡献

欢迎提交 Issue 和 Pull Request！